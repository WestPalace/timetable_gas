<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        padding: 0.5em;
        background-color: #121212;
        color: #f1f1f1;
      }

      h1 {
        margin-bottom: 0.5em;
        font-size: 2.6em;
        text-align: center;
        color: #ffffff;
      }

      .global-status {
        margin: 0.5em auto 1.2em;
        width: 90%;
        border-top: 1px solid #444;
        border-bottom: 1px solid #444;
        overflow: hidden;
        white-space: nowrap;
      }

      .global-status span {
        display: inline-block;
        padding-left: 100%;
        animation: marquee 20s linear infinite;
        font-weight: bold;
        font-size: 0.95em;
      }

      .global-status.normal span { color: #80e27e; }
      .global-status.alert span { color: #ff5252; }

      @keyframes marquee {
        0% { transform: translate(0, 0); }
        100% { transform: translate(-100%, 0); }
      }

      .lines-container {
        display: flex;
        gap: 1.2em;
        flex-wrap: wrap;
        justify-content: center;
      }

      .station-block {
        display: flex;
        flex-direction: column;
        gap: 1em;
        min-width: 240px;
        max-width: 280px;
        flex: 1;
      }

      .line-box {
        background: #1e1e1e;
        border: 2px solid #333;
        border-radius: 10px;
        padding: 0.8em;
        box-shadow: 2px 2px 8px rgba(255, 255, 255, 0.05);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 100%;
        min-height: 260px;
      }

      h2 {
        font-size: 1.2em;
        margin-bottom: 0.4em;
        color: #ffffff;
        text-align: center;
        line-height: 1.4em;
      }

      .timetable {
        font-size: 1em;
        width: 100%;
      }

      .timetable-header {
        display: flex;
        justify-content: space-between;
        font-weight: bold;
        padding: 0.2em 0;
        border-bottom: 1px solid #444;
        color: #bbbbbb;
      }

      .timetable-header div,
      .train div {
        flex: 1;
        text-align: center;
        white-space: nowrap;
      }

      .train {
        display: flex;
        justify-content: space-between;
        margin: 0.2em 0;
        padding: 0.3em 0.4em;
        background-color: #2a2a2a;
        border-radius: 5px;
        font-size: 1.1em;
      }

      .access {
        text-align: center;
        color: #f5f5f5;
        font-size: 0.95em;
        margin-bottom: 0.5em;
      }

      /* New styles for train types */
      .train-type-rapid {
        color: #ff5252; /* Red */
      }
      .train-type-express {
        color: #ffa500; /* Orange */
      }
      .train-type-semi-express {
        color: #adff2f; /* Yellow-green */
      }
    </style>
  </head>
  <body>
    <h1>æœ€å¯„é§…æ™‚åˆ»è¡¨</h1>

    <div class="global-status status normal" id="global-status">
      <span id="global-status-text">èª­ã¿è¾¼ã¿ä¸­...</span>
    </div>

    <div class="lines-container" id="lines-container">
      </div>

    <script>
      const stationInfo = [
        {
          name: "JRèŒ¨æœ¨é§…",
          walk: 6,
          lines: [
            { title: "JRèŒ¨æœ¨é§…<br>ï¼ˆç±³åŸæ–¹é¢ï¼‰", index: 0, id: "jr-east" },
            { title: "JRèŒ¨æœ¨é§…<br>ï¼ˆç¥æˆ¸æ–¹é¢ï¼‰", index: 1, id: "jr-west" },
          ],
        },
        {
          name: "é˜ªæ€¥å—èŒ¨æœ¨é§…",
          walk: 8,
          lines: [
            { title: "é˜ªæ€¥å—èŒ¨æœ¨é§…<br>ï¼ˆå¤§é˜ªæ¢…ç”°æ–¹é¢ï¼‰", index: 2, id: "hankyu-east" },
            { title: "é˜ªæ€¥å—èŒ¨æœ¨é§…<br>ï¼ˆäº¬éƒ½æ²³åŸç”ºæ–¹é¢ï¼‰", index: 3, id: "hankyu-west" },
          ],
        },
        {
          name: "å¤§é˜ªãƒ¢ãƒãƒ¬ãƒ¼ãƒ«å—èŒ¨æœ¨é§…",
          walk: 8,
          lines: [
            { title: "å¤§é˜ªãƒ¢ãƒãƒ¬ãƒ¼ãƒ«å—èŒ¨æœ¨é§…<br>ï¼ˆå¤§é˜ªç©ºæ¸¯æ–¹é¢ï¼‰", index: 4, id: "monorail-east" },
            { title: "å¤§é˜ªãƒ¢ãƒãƒ¬ãƒ¼ãƒ«å—èŒ¨æœ¨é§…<br>ï¼ˆé–€çœŸå¸‚æ–¹é¢ï¼‰", index: 5, id: "monorail-west" },
          ],
        },
      ];

      function createLayout() {
        const container = document.getElementById("lines-container");
        for (const station of stationInfo) {
          const block = document.createElement("div");
          block.className = "station-block";

          for (const line of station.lines) {
            const box = document.createElement("div");
            box.className = "line-box";
            box.id = line.id;

            box.innerHTML = `
              <h2>${line.title}</h2>
              <div class="access">ğŸƒå¾’æ­©${station.walk}åˆ†</div>
              <div class="timetable"></div>
            `;

            block.appendChild(box);
          }
          container.appendChild(block);
        }
      }

      function getTrainTypeClass(trainType) {
        if (trainType.includes("å¿«é€Ÿ")) {
          return "train-type-rapid";
        } else if (trainType.includes("æ€¥è¡Œ")) {
          return "train-type-express";
        } else if (trainType.includes("æº–æ€¥")) {
          return "train-type-semi-express";
        }
        return ""; // No specific class if not matched
      }

      function fetchTimetable() {
        google.script.run.withSuccessHandler(updateTimetables).getTimetableJson();
      }

      function updateTimetables(data) {
        const timetableData = data.timetableData;
        const statusData = data.statusData;

        const globalStatus = document.getElementById("global-status");
        const globalText = document.getElementById("global-status-text");
        const lineNames = ["JRäº¬éƒ½ç·š", "é˜ªæ€¥äº¬éƒ½æœ¬ç·š", "å¤§é˜ªãƒ¢ãƒãƒ¬ãƒ¼ãƒ«"];
        let alertFound = false;
        const summaries = statusData.map((s, i) => {
          if (s[0] !== "å¹³å¸¸é‹è»¢") alertFound = true;
          return `${lineNames[i]}: ${s[0]} - ${s[1]}`;
        });
        globalStatus.classList.remove("normal", "alert");
        globalStatus.classList.add(alertFound ? "alert" : "normal");
        globalText.textContent = summaries.join("ã€€");

        for (const station of stationInfo) {
          for (const line of station.lines) {
            const timetable = timetableData[line.index];
            const timetableElem = document.querySelector(`#${line.id} .timetable`);
            const trainList = timetable.map(train => `
              <div class="train">
                <div>${train.æ™‚åˆ»}</div>
                <div class="${getTrainTypeClass(train.ç¨®é¡)}">${train.ç¨®é¡}</div>
                <div>${train.è¡Œãå…ˆ}</div>
              </div>
            `).join("");

            timetableElem.innerHTML = `
              <div class="timetable-header">
                <div>ğŸ•’æ™‚åˆ»</div>
                <div>ğŸš†ç¨®åˆ¥</div>
                <div>ğŸ¯è¡Œå…ˆ</div>
              </div>
              ${trainList}
            `;
          }
        }
      }

      createLayout();
      fetchTimetable();
      setInterval(fetchTimetable, 60000);
    </script>
  </body>
</html>